<app-main-container [title]="isUpdate ? 'Actualizar Autorización' : 'Nueva Autorización'" >

<form [formGroup]="authForm" (ngSubmit)="onSubmit()" class="g-3 m-2">
  <div class="row">
    <div class="col-6">
      <div class="row">
        <div class="col-3">
          <label class="form-label m-0">Número de lote<label class="text-danger">*</label></label>
        </div>
        <div class="col-9">
          <ng-select [items]="plots" bindLabel="name" autofocus bindValue="id" class="w-100" formControlName="plotId"
                     (change)="onPlotSelected($event)"></ng-select>
          <div>
            <div class="ms-1 mt-2">
              @if (plot != null) {
                <small>Telefono: {{ plot.tel }}</small>
              }
              <small class="text-danger" *ngIf="authForm.get('plotId')?.invalid && authForm.get('plotId')?.touched">
                Por favor, ingrese un número de lote
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-6">
      <div class="row">
        <div class="col-3">
          <label for="visitor-type" class="form-label m-0">Tipo de Visitante</label>
        </div>
        <div class="col-9">
          <select id="visitor-type" class="form-select ms-2" formControlName="visitorType">
            <option value="OWNER">Dueño</option>
            <option value="WORKER">Trabajador</option>
            <option value="VISITOR">Visitante</option>
            <option value="EMPLOYEE">Empleado</option>
            <option value="PROVIDER">Proveedor</option>
            <option value="PROVIDER_ORGANIZATION">Organización Proveedora</option>
            <option value="COHABITANT">Conviviente</option>
            <option value="EMERGENCY">Emergencia</option>
          </select>
        </div>
        <div>
          <small class="text-danger ms-2"
                 *ngIf="authForm.get('visitorType')?.invalid && authForm.get('visitorType')?.touched">
            requerido
          </small>
        </div>
      </div>
    </div>
  </div>
  <div formGroupName="visitorRequest">
    <h5 class="mt-3">Detalles del Visitante</h5>
    <hr>

    <div class="row mb-3">
      <div class="col-6">
        <div class="row">
          <div class="col-3">
            <label for="name" class="form-label">Nombre</label><label class="text-danger">*</label>
          </div>
          <div class="col-9">
            <input type="text" id="name" class="form-control" formControlName="name"
                   [ngClass]="{'is-invalid': authForm.get('visitorRequest.name')?.invalid && authForm.get('visitorRequest.name')?.touched}"/>
            <div >
              <small class="text-danger"
                     *ngIf="authForm.get('visitorRequest.name')?.invalid && authForm.get('visitorRequest.name')?.touched">
                Por favor, ingrese el nombre del visitante
              </small>
            </div>
          </div>
        </div>
      </div>

      <div class="col-6">
        <div class="row">
          <div class="col-3">
            <label for="last-name" class="form-label">Apellido</label><label class="text-danger">*</label>
          </div>
          <div class="col-9">
            <input type="text" id="last-name" class="form-control" formControlName="lastName"
                   [ngClass]="{'is-invalid': authForm.get('visitorRequest.lastName')?.invalid && authForm.get('visitorRequest.lastName')?.touched}"/>
            <div>
              <small class="text-danger"
                     *ngIf="authForm.get('visitorRequest.lastName')?.invalid && authForm.get('visitorRequest.lastName')?.touched">
                Por favor, ingrese el apellido del visitante
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-6">
        <div class="row">
          <div class="col-3">
            <label for="doc-type" class="form-label">Tipo de Documento<label class="text-danger">*</label></label>
          </div>
          <div class="col-9">
            <select id="doc-type" class="form-select" formControlName="docType">
              <option value="DNI">DNI</option>
              <option value="PASSPORT">Pasaporte</option>
              <option value="CUIL">CUIL</option>
              <option value="CUIT">CUIT</option>
            </select>
          </div>
        </div>
      </div>

      <div class="col-6">
        <div class="row">
          <div class="col-3">
            <label for="doc-number" class="form-label">Número de Documento<label class="text-danger">*</label></label>
          </div>
          <div class="col-9">
            <input type="number" id="doc-number" class="form-control" formControlName="docNumber"
                   [ngClass]="{'is-invalid': authForm.get('visitorRequest.docNumber')?.invalid && authForm.get('visitorRequest.docNumber')?.touched}"/>
            <small class="text-danger"
                   *ngIf="authForm.get('visitorRequest.docNumber')?.invalid && authForm.get('visitorRequest.docNumber')?.touched">
              Por favor, ingrese el número de documento del visitante
            </small>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-2">
      <div class="col-6">
        <div class="row">
          <div class="col-3">
            <label for="birth-date" class="form-label">Fecha de Nacimiento</label>
          </div>
          <div class="col-9">
            <input type="date" id="birth-date" class="form-control" formControlName="birthDate"
                   [ngClass]="{'is-invalid': authForm.get('visitorRequest.birthDate')?.invalid && authForm.get('visitorRequest.birthDate')?.touched}"/>
            <small class="text-danger"
                   *ngIf="authForm.get('visitorRequest.birthDate')?.invalid && authForm.get('visitorRequest.birthDate')?.touched">
              Por favor, ingrese la fecha de nacimiento del visitante
            </small>
          </div>
        </div>
      </div>
      @if (this.userType != "GUARD") {
      <div class="col-6">
        <div class="row">
          <div class="col-3">
            <label class="form-label">Lista de horarios</label>
          </div>
          <div class="col-9">
            <button type="button" class="btn btn-info" (click)="openModal()"> Horarios</button>
          </div>
        </div>
      </div>
      }
    </div>

  </div>
  <app-toasts></app-toasts>

  <div class="col-12 d-flex justify-content-end mt-5">
    <button type="button" class="btn btn-danger me-2" (click)="onCancel()">Cancelar</button>
    <button type="submit" class="btn btn-primary">Guardar</button>
  </div>
</form>
